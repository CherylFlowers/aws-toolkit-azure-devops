{
    "id": "bffe416a-6b57-4324-bce1-ce02a750c941",
    "name": "CloudFormationCreateOrUpdateStack",
    "friendlyName": "AWS CloudFormation Create/Update Stack",
    "description": "Creates a new AWS CloudFormation stack or updates the stack if it exists.",
    "author": "Amazon Web Services",
    "helpMarkDown": "Please refer to [AWS CloudFormation User Guide](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/)",
    "category": "Deploy",
    "visibility": [
        "Build",
        "Release"
    ],
    "demands": [],
    "version": {
        "Major": "0",
        "Minor": "9",
        "Patch": "14"
    },
    "runsOn": [
        "Agent"
    ],
    "minimumAgentVersion": "1.95.0",
    "groups": [
        {
            "name": "Template",
            "displayName": "Template",
            "isExpanded": true
        },
        {
            "name": "OutputOptions",
            "displayName": "Output",
            "isExpanded": false
        }
    ],
    "instanceNameFormat": "AWS CloudFormation Create/Update Stack $(stackName)",
    "inputs": [
        {
            "name": "awsCredentials",
            "type": "connectedService:AWS",
            "label": "AWS Credentials",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Select the AWS credentials to use. If needed, click on 'manage', and add a new Service Endpoint of type 'AWSCredentials'"
        },
        {
            "name": "regionName",
            "label": "AWS Region",
            "type": "string",
            "required": true,
            "defaultValue": "",
            "helpMarkDown": "AWS region name, please check https://docs.aws.amazon.com/general/latest/gr/rande.html"
        },
        {
            "name": "stackName",
            "type": "string",
            "label": "Stack Name",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "The name that is associated with the stack. The name must be unique in the region in which you are creating the stack.\n\nA stack name can contain only alphanumeric characters (case sensitive) and hyphens. It must start with an alphabetic character and cannot be longer than 128 characters. "
        },
        {
            "name": "templateLocation",
            "type": "pickList",
            "label": "Template location",
            "required": true,
            "defaultValue": "LinkedArtifact",
            "groupName": "Template",
            "options": {
                "LinkedArtifact": "Linked artifact",
                "FileURL": "URL of the file"
            }
        },
        {
            "name": "cfFileLink",
            "type": "string",
            "label": "Template link",
            "defaultValue": "",
            "required": true,
            "groupName": "Template",
            "helpMarkDown": "Specify the URL of the AWS CloudFormation template file.\n\nThe URL must point to a template (max size: 460,800 bytes) that is located in an Amazon S3 bucket. For more information, go to the [Template Anatomy](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html) in the AWS CloudFormation User Guide. ",
            "visibleRule": "templateLocation = FileURL"
        },
        {
            "name": "cfParametersFileLink",
            "type": "string",
            "label": "Template parameters link",
            "defaultValue": "",
            "required": false,
            "groupName": "Template",
            "helpMarkDown": "Location of file containing the template parameters. The URL must point to a template parameters file that is located in an Amazon S3 bucket. For more information, go to the [Template Anatomy](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html) in the AWS CloudFormation User Guide.",
            "visibleRule": " templateLocation = FileURL"
        },
        {
            "name": "cfFile",
            "type": "filePath",
            "label": "Template",
            "defaultValue": "",
            "required": true,
            "groupName": "Template",
            "visibleRule": " templateLocation = LinkedArtifact",
            "helpMarkDown": "Specify the path to the AWS CloudFormation template. \n\nStructure containing the template body with a minimum length of 1 byte and a maximum length of 51,200 bytes. For more information, go to [Template Anatomy](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html) in the AWS CloudFormation User Guide."
        },
        {
            "name": "cfParametersFile",
            "type": "filePath",
            "label": "Template parameters",
            "defaultValue": "",
            "required": false,
            "groupName": "Template",
            "helpMarkDown": "Specify the path for the parameters file for the AWS CloudFormation template.",
            "visibleRule": " templateLocation = LinkedArtifact"
        },
        {
            "name": "onFailure",
            "type": "pickList",
            "label": "On Failure",
            "defaultValue": "",
            "groupName": "Template",
            "required": true,
            "helpMarkDown": "Determines what action will be taken if stack creation fails. \n\n Default: ROLLBACK",
            "options": {
                "DO_NOTHING": "Do Nothing",
                "ROLLBACK": "Rollback",
                "DELETE": "Delete"
            }
        },
        {
            "name": "disableRollback",
           "type": "boolean",
            "label": "Disable Rollback",
            "defaultValue": "false",
            "groupName": "Template",
            "required": false,
            "helpMarkDown": "Set to true to disable rollback of the stack if stack creation failed. You can specify either DisableRollback or OnFailure, but not both. \n\n Default: false"
        },
        {
            "name": "outputVariable",
            "type": "string",
            "label": "Output Variable",
            "defaultValue" : "",
            "groupName": "OutputOptions",
            "helpMarkDown": "The name of the variable that will contain the ID of the stack on task completion. The variable can be used as $(variableName) to refer to the stack ID in subsequent tasks.",
            "required": false
        }
    ],
    "execution": {
        "Node": {
            "target": "CloudFormationCreateOrUpdateStack.js",
            "argumentFormat": ""
        }
    },
    "messages": {
        "CheckingForStackExistence": "Checking existence for stack '%s'",
        "StackExists": "Stack exists, switching to stack update mode",
        "StackNotExist": "Stack does not exist, switching to stack create mode",
        "CreatingStackFromFiles": "Creating stack using template file '%s', parameters file '%s'",
        "CreatingStackFromUrls": "Creating stack using template url '%s', parameters url '%s'",
        "UpdatingStackFromFiles": "Updating stack using template file '%s', parameters file '%s'",
        "UpdatingStackFromUrls": "Updating stack using template url '%s', parameters url '%s'",
        "LoadingTemplateFile": "Loading template file from '%s'",
        "LoadingTemplateParameterFile": "Loading template parameters file from '%s'",
        "TemplateFilesLoadFailure": "Failed to load and/or parse the template or template parameters file, error: %s",
        "StackCreated": "Stack %s created successfully",
        "StackCreationFailed": "Stack %s failed to reach completion status, error: %s",
        "StackCreateRequestFailed": "Error requesting stack creation, error message: %s",
        "StackUpdated": "Stack %s updated successfully",
        "StackUpdateFailed": "Stack %s failed to reach update completion status, error: %s",
        "StackUpdateRequestFailed": "Error requesting stack update, error message: %s",
        "CreatedStackId": "Stack creation completed, new stack id %s",
        "UrlFormatError": "Template parameters url error, expected url satisfying regex '%s'",
        "ParametersUrlLoadOrParseError": "Failed to download or parse template parameters file, error: %s",
        "WaitingForStack": "Waiting for stack %s to reach create create or update completed status",
        "TaskCompleted": "Stack %s created successfully, stack ID %s",
        "SettingOutputVariable": "Setting stack ID into output variable %s"
    }
}